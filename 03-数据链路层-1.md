## 1 <u>数据链路层的基本概念</u>

结点：计算机网络中每一台主机，或者交换设备(集线器、路由器等等)都是一个结点。

链路 (link): 是一条无源的点到点的==物理通道==, 中间没有任何其他的交换结点。它可以使有线的和无线的。

数据链路 (data link): 除了物理线路外,还必须有==通信协议==来控制这些数据的传输，是==逻辑通道==。

帧：数据链路层的协议数据单元，作用是封装网络层的数据报(包)。



数据链路层传输的实质：把一个结点==网络层==的数据传输给另一个结点的==网络层==，传输的载体是==帧==。

* 准确的说，从逻辑上来讲，就是把一个结点网络层的数据报，封装成帧，传输，然后到达后解封装，把数据报传递给网络层

<img src=".\Pictures\3\数据链路层.PNG" style="zoom:60%;" />

本来数据的发送是通过封装，然后通过物理层传输，然后再解封装的过程。但是我们可以从逻辑上认为数据是在数据链路层之间进行传输的。



数据链路层使用物理层的服务，为网络层提供服务。

==最主要、最基本的功能==：加强物理层传输比特流的能力。它将可能出错的==物理连接==，改造为==逻辑上无差错的数据链路==，使之对网络层表现为==一条无差错的链路==。

## 2 <u>数据链路层的功能</u>

为网络层提供服务 + 链路管理 + 组帧 + 差错控制 + 流量控制

### 2.1 为网络层提供服务

数据链路层可以提供三种类型的服务

1. 无确认无连接服务：源机器发送数据帧不需要建立链路连接。目的机器收到数据帧不需要发回确认。丢失的帧不负责重发，而是交给上层处理。适用于实时通信（为了速度快），或者误码率低的通信通道，如以太网。
2. 有确认无连接服务：源机器发送数据帧不需要建立链路连接。目的机器收到数据帧必须发回确认。为了==提升传输可靠性==，如果规定时间源机器没有收到确认信息，就会重传丢失的帧。适用于误码率较高的通信信道，如无线通信。
3. 有确认面向连接的服务：必须经历 建立数据链路 + 传输帧 + 释放数据链路的过程。目的机器每收到一个帧，都要给出确认；源机器收到确认才能发送下一个帧。它的可靠性最高。适用于对通信要求很高的场合。

> <font color = "red">面向连接必须有确认；既有链接一定有确认，无确认一定无连接</font>

### 2.2 链路管理

链路管理：数据链路层连接的建立，维持，释放统称为链路管理。适用于==面向链接==的服务。

### 2.3 组帧（封装成帧）

**组帧**

组帧：两台主机传输信息时，将网络层的分组封装成帧，以帧的形式进行传输。

将一段数据前后部分别添加首部和尾部，就构成了帧。数据链路层的帧长 = 数据部分长度 + 首部 + 尾部

* MTU (Maximum Transmission Unit) 最大传输单元，不同协议规定了帧数据部分的长度上限，也就是这个MTU。
* 为了提高帧的传输效率，一般让数据部分尽可能的大于首部和尾部的长度，但小于等于MTU

<img src=".\Pictures\3\封装成帧.PNG" style="zoom:60%;" />

**帧的首尾部**

首部和尾部包含很多信息，其中包含==帧定界符==，它包含帧的开始或者结束的标志，用来确定帧的边界。

<font color ="red">帧定界</font>：帧定界符能确定帧的起始和结束位置。在发送时是从帧开始部分发送，接受是从帧开始的部分开始接收

<font color ="red">帧同步</font>：==接受方==可以从接收到的二进制比特流中区分出帧的起始和终止。





* 组帧既要添加首部，也要添加尾部。因为网络中是以帧为最小单位进行传输的。接收端接受的是一串比特流，不确定首部和尾部是无法从比特流中识别哪里开始哪里结束的。
* IP数据报：包含帧的数据部分，因此只需要首部，不一定需要尾部

1. 帧定界：帧定界符的作用。

2. 帧同步

3. 透明传输：不管传输数据是什么==比特组合==，都应当在链路上进行传输。当所传数据中的比特组合恰巧与某一个控制信息（比如定界符）完全一样时，就必须采取适当的措施，使接收方不会将这样的数据误认为是某种控制信息。这样才能保证数据链路层的传输是透明的。

组帧一共有四种方法，来实现透明传输。 字符计数法 + 字符填充收尾定界符法 + 零比特填充首位标志法 + 违规编码法

#### （1）字符计数法

帧头部使用一个计数（字段/字节）来标明帧内字符数，包含首字节。

比如第一个帧第一个字节是5，则表示这一个帧一共占据5个字节。

<img src=".\Pictures\3\字符计数法.PNG" style="zoom:60%;" />

问题：如果一个计数字段发生错误，基本上后面所有的帧都会失去帧同步。

#### （2）字符填充法

使用特定的字符来定界帧的开始和结束，不同的协议规定这些字符的比特组合是不一样的

* SOH(Start of Header)帧首部的字节
* EOT(End of Transmission)帧尾部的字节

<img src=".\Pictures\3\字符填充法.PNG" style="zoom:40%;" />

当传输的帧是由文本文件组成时候（都是ASCII码），不管键盘输入什么字符，都可以实现透明传输。

如果帧是非ASCII码的文本文件组成（比如二进制的程序或者图像）就需要==字符填充法实现透明传输==，因为它可能出现和SOH 或者EOT一样的比特组合。



字符填充法：

1. 发送方在每个EOT或者SOH字符前再传入一个转义字符ESC字符。如果已经出现了转义字符，那么再添加一个转义字符。
2. 接收方收到数据后会自己删除这个插入的ESC字符

<img src=".\Pictures\3\字符填充法2.PNG" style="zoom:40%;" />

#### （3）零比特填充的首位标志法

使用0111110 标志一帧的开始和结束。

在发送端，扫描整个信息字段，只有连续5个1，就立即填入一个0

在接收端收到一个帧的时候，先找到标志字段确定边界，在对比特流进行扫描，发现5个1就把后面的0删除



它保证了透明传输，在传输的比特流可以传输任意比特组合，不会引起帧边界的判断错误

易于操作，性能上硬件更容易实现，由于字符填充法

（4）违规编码法

### 4 差错控制

传输差错：通信链路并不是理想的，数据在通信链路在传输过程中很可能会发生差错,就叫做==传输差错==。

#### 4.1 差错产生的原因和种类

传输差错都是由链路中的==噪声==引起的。

* 全局性噪声：由于线路本身的电气特性所产生的==随机噪声（热噪声）==，是信道固有的，随机存在的。
  * 解决方法：对传输介质或者传输设备下手，提升==信噪比==，减少干扰。
* 局部性噪声：==产生差错的主要原因==。是由于一些原因造成的==冲击噪声==而导致的传输差错。
  * 解决方法：利用==编码技术==来解决

传输差错可以分为位错和帧错

* 位错（比特差错）：<font color="red">比特差错</font>：传输差错的一种。比特在传输过程中会产生差错，1变成0,0变成1。
* 帧错：以帧为单位发生错误：
  * 丢失
  * 重复
  * 失序

#### 4.2 差错控制的原理 

数据链路层的编码和物理层的编码和调制有所不同：

* 物理层的编码针对的是==单个比特==，解决比特如何进行传输，如何解决比特同步的问题。
* 数据链路层的编码针对的是==一组比特==。它要对一组比特进行检错和纠错。



本章的差错控制主要解决比特差错

* 检错编码：奇偶校验吗和循环冗余码CRC
* 纠错编码：海明码



冗余码：在数据发送之前，先按照某种关系附加上一定的冗余位，构成一个符合某个规则的码字后再发送。当要发送的有效数据变化是，相应的冗余位也随之变化，使码字遵从不变的规则。接收端根据收到的码字是否仍符合原规则，从而判断是否出错误。



奇偶校验码：

有n-1位信息元：就是我们要发送的数据

1位校验码：可以理解为冗余码

奇校验码：



局限性：检测出 

1100101 奇校验，下列哪种错误不能被检测

11000011 11001010   11001100   11010011

采用奇校验，添加校验码之后要让字符1变为基数个----11001011---可以校验了，偶校验填0





特点：只能检测出基数个比特错误，检错能力为50%







准备要发送的数据：一系列比特的组合，切割开，d位的组，每个组都加上冗余码构成帧再发送

r+1位 x3 x2 +1  和  1101 差不多，多项式  阶：

==生成多项式不用背，肯定会给==

模2 等同于异或 加不进位，减法不退位









CRC硬件处理：  





不是可靠传输，因为他还丢弃了一部分帧











 
